---
import { z } from "astro:content";
import { SecondaryNav } from "../components/TopNav/SecondaryNav";
import Page from "./Page.astro";
import klientoLogo from "../assets/images/kliento-logo.png";
import { primaryNavLinks } from "../components/TopNav/config";

interface Frontmatter {
  title: string;
  description: string;
  service?: string;
  activeSection?: string | null;
  ogImage?: string;
  ogType?: string;
}

interface Props {
  frontmatter?: Frontmatter;
  title?: string;
  description?: string;
  service?: string;
  activeSection?: string | null;
  ogImage?: string;
  ogType?: string;
}

const schema = z.object({
  title: z.string(),
  description: z.string(),
  service: z.string().optional(),
  activeSection: z.string().nullable().optional(),
  ogImage: z.string().optional(),
  ogType: z.string().optional(),
});

const {
  title,
  description,
  service = "Kliento",
  activeSection = null,
  ogImage,
  ogType,
} = schema.parse(Astro.props.frontmatter ?? Astro.props);

// Find secondary links for Kliento from primaryNavLinks
const findServiceLinks = (serviceName: string) => {
  const parentItem = primaryNavLinks.find((item) =>
    item.children?.some((child) => child.text.toLowerCase() === serviceName.toLowerCase()),
  );

  if (parentItem?.children) {
    const serviceItem = parentItem.children.find(
      (child) => child.text.toLowerCase() === serviceName.toLowerCase(),
    );
    return serviceItem?.children || [];
  }
  return [];
};

const serviceLinks = findServiceLinks(service);
---

<Page title={title} description={description} ogImage={ogImage} ogType={ogType}>
  <SecondaryNav
    client:load
    activeSection={activeSection}
    serviceName={service}
    serviceLinks={serviceLinks}
    logoSrc={service === "Kliento" ? klientoLogo.src : ""}
    slot="kliento-header"
  />
  <slot />
</Page>
